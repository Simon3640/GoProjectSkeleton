meta {
  name: GetMailPitAdminMessages
  type: http
  seq: 1.4
}

get {
  url: http://{{mailhogHost}}:8025/api/v1/messages?limit=1
  body: none
  auth: inherit
}

params:query {
  limit: 1
}

script:pre-request {
  // Wait for mail
  bru.sleep(1000)
}

script:post-response {
  const response = res.getBody();

  test("status code", function(){
      expect(res.getStatus()).to.equal(200);
  })

  // Get last message ID for admin password reset
  bru.setEnvVar("lastMessageID", response.messages[0].ID)
}

settings {
  encodeUrl: true
  timeout: 0
}
