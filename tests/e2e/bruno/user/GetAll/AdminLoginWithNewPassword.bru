meta {
  name: AdminLoginWithNewPassword
  type: http
  seq: 0.7
}

post {
  url: {{baseURL}}/auth/login
  body: json
  auth: bearer
}

params:query {
  ~:
}

headers {
  Accept-Language: es-ES
}

auth:bearer {
  token:
}

body:json {
  {
    "email": "{{adminEmail}}",
    "password": "{{newAdminPassword}}"
  }
}

script:post-response {
  const response = res.getBody()

  test("Status code is 200", function () {
      expect(res.getStatus()).to.equal(200);
  });

  test("Access Token is present", function () {
      expect(response.data.accessToken).to.not.be.null;
  });

  test("Refresh Token is present", function () {
      expect(response.data.refreshToken).to.not.be.null;
  });

  test("Login with new password is successful", function () {
      expect(response.data.accessToken).to.exist;
      expect(response.data.refreshToken).to.exist;
  });

  bru.setEnvVar("adminToken", response.data.accessToken);
  bru.setEnvVar("refreshAdminToken", response.data.refreshToken);
}

settings {
  encodeUrl: true
}
